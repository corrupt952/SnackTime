# E2E Test Requirements

## 現在実装済みのE2Eテスト

1. **拡張機能の読み込み確認** (`extension.spec.ts`)
   - ポップアップが正しく開くか
   - ポップアップページのタイトル確認

2. **タイマーUIの注入確認** (`extension.spec.ts`)
   - Webページ(example.com)を開く
   - ポップアップから1分タイマーをクリック
   - タイマーUI(`#snack-time-root`)がページに表示されるか確認

3. **オプションページテスト** (`options.spec.ts`)
   - テーマ切り替え（システム/ライト/ダーク/レモン/ミント/ローズ）の動作確認
   - 通知タイプ設定（None/Alarm）の変更と保持
   - アラームサウンド設定（Simple/Piano）の変更と保持
   - 設定変更後のリロードでも設定が保持されるか

4. **ポップアッププリセットボタンテスト** (`popup-presets.spec.ts`)
   - 複数のプリセットボタン（1分、3分、5分、10分）の動作確認
   - 各プリセットボタンが表示されることを確認
   - タイマーが正しく注入されることを確認

5. **複数タブテスト** (`multi-tab.spec.ts`)
   - 異なるタブで独立したタイマーが動作することを確認
   - タブを切り替えてもタイマーが維持されることを確認

6. **ポップアップカスタム機能テスト** (`popup-custom.spec.ts`)
   - カスタム時間設定モーダルの開閉動作確認
   - 終了時刻設定モーダルの開閉動作確認

7. **基本的なUI操作** (`timer-basic.spec.ts`) - ※未実装
   - タイマーUIの注入確認（closed Shadow DOMのため内部操作は不可）
   - プリセットボタンの表示確認（closed Shadow DOMのため内部操作は不可）
   - オプションページへのナビゲーション（closed Shadow DOMのため内部操作は不可）

8. **コア機能テスト** (`timer-core.spec.ts`) - ※現在スキップ中
   - closed Shadow DOMの制約により、タイマー内部の操作テストは実行不可
   - 将来的にはShadow DOMをopenに変更するか、別のテスト戦略が必要

## 必要なE2Eテスト

### コア機能
- [ ] タイマーの開始・一時停止・停止の動作確認（closed Shadow DOMのため実装不可）
- [x] 複数の時間プリセット（1分、3分、5分、10分）の動作確認
- [ ] カスタム時間入力（例: "1:30", "90s"）の動作確認（closed Shadow DOMのため実装不可）
- [ ] タイマー完了時の通知表示（closed Shadow DOMのため実装不可）
- [ ] タイマー完了時のサウンド再生（設定に応じて）（closed Shadow DOMのため実装不可）

### UI操作
- [ ] タイマーUIのドラッグ&ドロップ機能（closed Shadow DOMのため実装不可）
- [x] 複数タブでの独立したタイマー動作確認
- [x] ポップアップからの操作がコンテンツスクリプトに正しく反映されるか
- [ ] Shadow DOM内でのスタイル隔離確認（closed Shadow DOMのため検証不可）
- [x] カスタム時間設定モーダルの開閉（ポップアップ内）
- [x] 終了時刻設定モーダルの開閉（ポップアップ内）

### 設定機能（Options Page）
- [x] テーマ切り替え（システム/ライト/ダーク/レモン/ミント/ローズ）の動作確認
- [x] サウンド設定の切り替え（アラームサウンドの選択）
- [x] 通知設定の変更と反映（None/Alarm）
- [x] 設定変更後のリロードでも設定が保持されるか

### データ管理
- [ ] タイマー使用履歴の記録確認（closed Shadow DOMのため履歴生成の確認が困難）
- [ ] 履歴の表示機能（ポップアップのRecentセクション表示は確認可能だが、動的な履歴追加は困難）
- [ ] 履歴の削除機能（closed Shadow DOMのため実装不可）
- [ ] chrome.storage.syncでの設定同期（複数デバイス間）
- [ ] ストレージ容量制限への対応

### エッジケース
- [ ] 拡張機能の更新後もデータが保持されるか
- [ ] タブがバックグラウンドになってもタイマーが正確に動作するか（closed Shadow DOMのため検証困難）
- [ ] ページリロード時のタイマー状態の扱い（closed Shadow DOMのため検証困難）
- [ ] 無効なターゲット時間入力時のエラーハンドリング（closed Shadow DOMのため実装不可）

## テスト環境の考慮事項

- Manifest V3の制約（Service Worker、非永続的バックグラウンド）
- Chrome Extension APIのモック
- 実際のChrome拡張機能としてのロードとテスト
- CI環境でのヘッドレスモード対応